// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package provider

import (
	"context"
	"github.com/conductorone/terraform-provider-conductorone/internal/provider/typeconvert"
	tfTypes "github.com/conductorone/terraform-provider-conductorone/internal/provider/types"
	"github.com/conductorone/terraform-provider-conductorone/internal/sdk/models/shared"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
)

func (r *UserDataSourceModel) RefreshFromSharedSearchUsersResponse(ctx context.Context, resp *shared.SearchUsersResponse) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		if resp.Expanded != nil {
		}
		if len(resp.List) == 0 {
			diags.AddError("Unexpected response from API", "Missing response body array data.")
			return diags
		}

		diags.Append(r.RefreshFromSharedUserView(ctx, &resp.List[0])...)

		if diags.HasError() {
			return diags
		}

		r.NextPageToken = types.StringPointerValue(resp.NextPageToken)
	}

	return diags
}

func (r *UserDataSourceModel) RefreshFromSharedUser(ctx context.Context, resp *shared.User) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		r.CreatedAt = types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.CreatedAt))
		r.DelegatedUserID = types.StringPointerValue(resp.DelegatedUserID)
		r.DeletedAt = types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.DeletedAt))
		r.Department = types.StringPointerValue(resp.Department)
		if resp.DepartmentSources != nil {
			if r.DepartmentSources == nil {
				r.DepartmentSources = []tfTypes.UserAttributeMappingSource{}
			}

			for _, departmentSourcesItem := range resp.DepartmentSources {
				var departmentSources tfTypes.UserAttributeMappingSource

				departmentSources.AppID = types.StringPointerValue(departmentSourcesItem.AppID)
				departmentSources.AppUserID = types.StringPointerValue(departmentSourcesItem.AppUserID)
				departmentSources.AppUserProfileAttributeKey = types.StringPointerValue(departmentSourcesItem.AppUserProfileAttributeKey)
				departmentSources.UserAttributeMappingID = types.StringPointerValue(departmentSourcesItem.UserAttributeMappingID)
				departmentSources.Value = types.StringPointerValue(departmentSourcesItem.Value)

				r.DepartmentSources = append(r.DepartmentSources, departmentSources)
			}
		}
		if resp.DirectoryIds != nil {
			if r.DirectoryIds == nil {
				r.DirectoryIds = make([]types.String, 0, len(resp.DirectoryIds))
			}
			for _, v := range resp.DirectoryIds {
				r.DirectoryIds = append(r.DirectoryIds, types.StringValue(v))
			}
		}
		if resp.DirectoryStatus != nil {
			r.DirectoryStatus = types.StringValue(string(*resp.DirectoryStatus))
		} else {
			r.DirectoryStatus = types.StringNull()
		}
		if resp.DirectoryStatusSources != nil {
			if r.DirectoryStatusSources == nil {
				r.DirectoryStatusSources = []tfTypes.UserAttributeMappingSource{}
			}

			for _, directoryStatusSourcesItem := range resp.DirectoryStatusSources {
				var directoryStatusSources tfTypes.UserAttributeMappingSource

				directoryStatusSources.AppID = types.StringPointerValue(directoryStatusSourcesItem.AppID)
				directoryStatusSources.AppUserID = types.StringPointerValue(directoryStatusSourcesItem.AppUserID)
				directoryStatusSources.AppUserProfileAttributeKey = types.StringPointerValue(directoryStatusSourcesItem.AppUserProfileAttributeKey)
				directoryStatusSources.UserAttributeMappingID = types.StringPointerValue(directoryStatusSourcesItem.UserAttributeMappingID)
				directoryStatusSources.Value = types.StringPointerValue(directoryStatusSourcesItem.Value)

				r.DirectoryStatusSources = append(r.DirectoryStatusSources, directoryStatusSources)
			}
		}
		r.DisplayName = types.StringPointerValue(resp.DisplayName)
		r.Email = types.StringPointerValue(resp.Email)
		if resp.Emails != nil {
			if r.Emails == nil {
				r.Emails = make([]types.String, 0, len(resp.Emails))
			}
			for _, v := range resp.Emails {
				r.Emails = append(r.Emails, types.StringValue(v))
			}
		}
		if resp.EmailSources != nil {
			if r.EmailSources == nil {
				r.EmailSources = []tfTypes.UserAttributeMappingSource{}
			}

			for _, emailSourcesItem := range resp.EmailSources {
				var emailSources tfTypes.UserAttributeMappingSource

				emailSources.AppID = types.StringPointerValue(emailSourcesItem.AppID)
				emailSources.AppUserID = types.StringPointerValue(emailSourcesItem.AppUserID)
				emailSources.AppUserProfileAttributeKey = types.StringPointerValue(emailSourcesItem.AppUserProfileAttributeKey)
				emailSources.UserAttributeMappingID = types.StringPointerValue(emailSourcesItem.UserAttributeMappingID)
				emailSources.Value = types.StringPointerValue(emailSourcesItem.Value)

				r.EmailSources = append(r.EmailSources, emailSources)
			}
		}
		if resp.EmployeeIds != nil {
			if r.EmployeeIds == nil {
				r.EmployeeIds = make([]types.String, 0, len(resp.EmployeeIds))
			}
			for _, v := range resp.EmployeeIds {
				r.EmployeeIds = append(r.EmployeeIds, types.StringValue(v))
			}
		}
		if resp.EmployeeIDSources != nil {
			if r.EmployeeIDSources == nil {
				r.EmployeeIDSources = []tfTypes.UserAttributeMappingSource{}
			}

			for _, employeeIDSourcesItem := range resp.EmployeeIDSources {
				var employeeIDSources tfTypes.UserAttributeMappingSource

				employeeIDSources.AppID = types.StringPointerValue(employeeIDSourcesItem.AppID)
				employeeIDSources.AppUserID = types.StringPointerValue(employeeIDSourcesItem.AppUserID)
				employeeIDSources.AppUserProfileAttributeKey = types.StringPointerValue(employeeIDSourcesItem.AppUserProfileAttributeKey)
				employeeIDSources.UserAttributeMappingID = types.StringPointerValue(employeeIDSourcesItem.UserAttributeMappingID)
				employeeIDSources.Value = types.StringPointerValue(employeeIDSourcesItem.Value)

				r.EmployeeIDSources = append(r.EmployeeIDSources, employeeIDSources)
			}
		}
		r.EmploymentStatus = types.StringPointerValue(resp.EmploymentStatus)
		if resp.EmploymentStatusSources != nil {
			if r.EmploymentStatusSources == nil {
				r.EmploymentStatusSources = []tfTypes.UserAttributeMappingSource{}
			}

			for _, employmentStatusSourcesItem := range resp.EmploymentStatusSources {
				var employmentStatusSources tfTypes.UserAttributeMappingSource

				employmentStatusSources.AppID = types.StringPointerValue(employmentStatusSourcesItem.AppID)
				employmentStatusSources.AppUserID = types.StringPointerValue(employmentStatusSourcesItem.AppUserID)
				employmentStatusSources.AppUserProfileAttributeKey = types.StringPointerValue(employmentStatusSourcesItem.AppUserProfileAttributeKey)
				employmentStatusSources.UserAttributeMappingID = types.StringPointerValue(employmentStatusSourcesItem.UserAttributeMappingID)
				employmentStatusSources.Value = types.StringPointerValue(employmentStatusSourcesItem.Value)

				r.EmploymentStatusSources = append(r.EmploymentStatusSources, employmentStatusSources)
			}
		}
		r.EmploymentType = types.StringPointerValue(resp.EmploymentType)
		if resp.EmploymentTypeSources != nil {
			if r.EmploymentTypeSources == nil {
				r.EmploymentTypeSources = []tfTypes.UserAttributeMappingSource{}
			}

			for _, employmentTypeSourcesItem := range resp.EmploymentTypeSources {
				var employmentTypeSources tfTypes.UserAttributeMappingSource

				employmentTypeSources.AppID = types.StringPointerValue(employmentTypeSourcesItem.AppID)
				employmentTypeSources.AppUserID = types.StringPointerValue(employmentTypeSourcesItem.AppUserID)
				employmentTypeSources.AppUserProfileAttributeKey = types.StringPointerValue(employmentTypeSourcesItem.AppUserProfileAttributeKey)
				employmentTypeSources.UserAttributeMappingID = types.StringPointerValue(employmentTypeSourcesItem.UserAttributeMappingID)
				employmentTypeSources.Value = types.StringPointerValue(employmentTypeSourcesItem.Value)

				r.EmploymentTypeSources = append(r.EmploymentTypeSources, employmentTypeSources)
			}
		}
		r.ID = types.StringPointerValue(resp.ID)
		r.JobTitle = types.StringPointerValue(resp.JobTitle)
		if resp.JobTitleSources != nil {
			if r.JobTitleSources == nil {
				r.JobTitleSources = []tfTypes.UserAttributeMappingSource{}
			}

			for _, jobTitleSourcesItem := range resp.JobTitleSources {
				var jobTitleSources tfTypes.UserAttributeMappingSource

				jobTitleSources.AppID = types.StringPointerValue(jobTitleSourcesItem.AppID)
				jobTitleSources.AppUserID = types.StringPointerValue(jobTitleSourcesItem.AppUserID)
				jobTitleSources.AppUserProfileAttributeKey = types.StringPointerValue(jobTitleSourcesItem.AppUserProfileAttributeKey)
				jobTitleSources.UserAttributeMappingID = types.StringPointerValue(jobTitleSourcesItem.UserAttributeMappingID)
				jobTitleSources.Value = types.StringPointerValue(jobTitleSourcesItem.Value)

				r.JobTitleSources = append(r.JobTitleSources, jobTitleSources)
			}
		}
		if resp.ManagerIds != nil {
			if r.ManagerIds == nil {
				r.ManagerIds = make([]types.String, 0, len(resp.ManagerIds))
			}
			for _, v := range resp.ManagerIds {
				r.ManagerIds = append(r.ManagerIds, types.StringValue(v))
			}
		}
		if resp.ManagerSources != nil {
			if r.ManagerSources == nil {
				r.ManagerSources = []tfTypes.UserAttributeMappingSource{}
			}

			for _, managerSourcesItem := range resp.ManagerSources {
				var managerSources tfTypes.UserAttributeMappingSource

				managerSources.AppID = types.StringPointerValue(managerSourcesItem.AppID)
				managerSources.AppUserID = types.StringPointerValue(managerSourcesItem.AppUserID)
				managerSources.AppUserProfileAttributeKey = types.StringPointerValue(managerSourcesItem.AppUserProfileAttributeKey)
				managerSources.UserAttributeMappingID = types.StringPointerValue(managerSourcesItem.UserAttributeMappingID)
				managerSources.Value = types.StringPointerValue(managerSourcesItem.Value)

				r.ManagerSources = append(r.ManagerSources, managerSources)
			}
		}
		if resp.Profile == nil {
			r.Profile = nil
		} else {
			r.Profile = &tfTypes.Profile{}
		}
		if resp.RoleIds != nil {
			if r.RoleIds == nil {
				r.RoleIds = make([]types.String, 0, len(resp.RoleIds))
			}
			for _, v := range resp.RoleIds {
				r.RoleIds = append(r.RoleIds, types.StringValue(v))
			}
		}
		if resp.Status != nil {
			r.Status = types.StringValue(string(*resp.Status))
		} else {
			r.Status = types.StringNull()
		}
		if resp.Type != nil {
			r.Type = types.StringValue(string(*resp.Type))
		} else {
			r.Type = types.StringNull()
		}
		r.UpdatedAt = types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.UpdatedAt))
		r.Username = types.StringPointerValue(resp.Username)
		if resp.Usernames != nil {
			if r.Usernames == nil {
				r.Usernames = make([]types.String, 0, len(resp.Usernames))
			}
			for _, v := range resp.Usernames {
				r.Usernames = append(r.Usernames, types.StringValue(v))
			}
		}
		if resp.UsernameSources != nil {
			if r.UsernameSources == nil {
				r.UsernameSources = []tfTypes.UserAttributeMappingSource{}
			}

			for _, usernameSourcesItem := range resp.UsernameSources {
				var usernameSources tfTypes.UserAttributeMappingSource

				usernameSources.AppID = types.StringPointerValue(usernameSourcesItem.AppID)
				usernameSources.AppUserID = types.StringPointerValue(usernameSourcesItem.AppUserID)
				usernameSources.AppUserProfileAttributeKey = types.StringPointerValue(usernameSourcesItem.AppUserProfileAttributeKey)
				usernameSources.UserAttributeMappingID = types.StringPointerValue(usernameSourcesItem.UserAttributeMappingID)
				usernameSources.Value = types.StringPointerValue(usernameSourcesItem.Value)

				r.UsernameSources = append(r.UsernameSources, usernameSources)
			}
		}
	}

	return diags
}

func (r *UserDataSourceModel) RefreshFromSharedUserView(ctx context.Context, resp *shared.UserView) diag.Diagnostics {
	var diags diag.Diagnostics

	r.DelegatedUserPath = types.StringPointerValue(resp.DelegatedUserPath)
	r.DirectoriesPath = types.StringPointerValue(resp.DirectoriesPath)
	r.ManagersPath = types.StringPointerValue(resp.ManagersPath)
	r.RolesPath = types.StringPointerValue(resp.RolesPath)
	diags.Append(r.RefreshFromSharedUser(ctx, resp.User)...)

	if diags.HasError() {
		return diags
	}

	return diags
}

func (r *UserDataSourceModel) ToSharedSearchUsersRequest(ctx context.Context) (*shared.SearchUsersRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var departments []string
	if r.Departments != nil {
		departments = make([]string, 0, len(r.Departments))
		for _, departmentsItem := range r.Departments {
			departments = append(departments, departmentsItem.ValueString())
		}
	}
	email := new(string)
	if !r.Email.IsUnknown() && !r.Email.IsNull() {
		*email = r.Email.ValueString()
	} else {
		email = nil
	}
	var excludeIds []string
	if r.ExcludeIds != nil {
		excludeIds = make([]string, 0, len(r.ExcludeIds))
		for _, excludeIdsItem := range r.ExcludeIds {
			excludeIds = append(excludeIds, excludeIdsItem.ValueString())
		}
	}
	var excludeTypes []shared.ExcludeTypes
	if r.ExcludeTypes != nil {
		excludeTypes = make([]shared.ExcludeTypes, 0, len(r.ExcludeTypes))
		for _, excludeTypesItem := range r.ExcludeTypes {
			excludeTypes = append(excludeTypes, shared.ExcludeTypes(excludeTypesItem.ValueString()))
		}
	}
	var ids []string
	if r.Ids != nil {
		ids = make([]string, 0, len(r.Ids))
		for _, idsItem := range r.Ids {
			ids = append(ids, idsItem.ValueString())
		}
	}
	var jobTitles []string
	if r.JobTitles != nil {
		jobTitles = make([]string, 0, len(r.JobTitles))
		for _, jobTitlesItem := range r.JobTitles {
			jobTitles = append(jobTitles, jobTitlesItem.ValueString())
		}
	}
	var managerIds []string
	if r.ManagerIds != nil {
		managerIds = make([]string, 0, len(r.ManagerIds))
		for _, managerIdsItem := range r.ManagerIds {
			managerIds = append(managerIds, managerIdsItem.ValueString())
		}
	}
	pageSize := new(int)
	if !r.PageSize.IsUnknown() && !r.PageSize.IsNull() {
		*pageSize = int(r.PageSize.ValueInt32())
	} else {
		pageSize = nil
	}
	query := new(string)
	if !r.Query.IsUnknown() && !r.Query.IsNull() {
		*query = r.Query.ValueString()
	} else {
		query = nil
	}
	var refs []shared.UserRef
	if r.Refs != nil {
		refs = make([]shared.UserRef, 0, len(r.Refs))
		for _, refsItem := range r.Refs {
			id := new(string)
			if !refsItem.ID.IsUnknown() && !refsItem.ID.IsNull() {
				*id = refsItem.ID.ValueString()
			} else {
				id = nil
			}
			refs = append(refs, shared.UserRef{
				ID: id,
			})
		}
	}
	var roleIds []string
	if r.RoleIds != nil {
		roleIds = make([]string, 0, len(r.RoleIds))
		for _, roleIdsItem := range r.RoleIds {
			roleIds = append(roleIds, roleIdsItem.ValueString())
		}
	}
	var userStatuses []shared.UserStatuses
	if r.UserStatuses != nil {
		userStatuses = make([]shared.UserStatuses, 0, len(r.UserStatuses))
		for _, userStatusesItem := range r.UserStatuses {
			userStatuses = append(userStatuses, shared.UserStatuses(userStatusesItem.ValueString()))
		}
	}
	out := shared.SearchUsersRequest{
		Departments:  departments,
		Email:        email,
		ExcludeIds:   excludeIds,
		ExcludeTypes: excludeTypes,
		Ids:          ids,
		JobTitles:    jobTitles,
		ManagerIds:   managerIds,
		PageSize:     pageSize,
		Query:        query,
		Refs:         refs,
		RoleIds:      roleIds,
		UserStatuses: userStatuses,
	}

	return &out, diags
}
